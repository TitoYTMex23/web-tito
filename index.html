<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITOMX STORE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background-color: #0f0f0f; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 10px; }
        .game-card { 
            background: #1a1a1a; 
            margin-bottom: 12px; 
            padding: 10px; 
            border-radius: 10px; 
            display: flex; 
            align-items: start; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 1px solid #333;
        }
        .game-img { 
            width: 80px; 
            height: 110px; 
            object-fit: cover; 
            border-radius: 6px; 
            margin-right: 12px; 
            background: #222; 
        }
        .game-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; height: 110px; }
        h3 { margin: 0 0 4px 0; font-size: 16px; color: #fff; font-weight: 600; line-height: 1.2; }
        .meta { color: #00ff88; font-size: 11px; font-weight: bold; margin-bottom: 4px; }
        .desc { font-size: 10px; color: #aaa; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .btn-download { 
            background: linear-gradient(90deg, #0088cc, #005f8f); 
            color: white; 
            border: none; 
            padding: 8px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            font-weight: bold; 
            width: 100%; 
            text-transform: uppercase;
            margin-top: auto;
        }
        .btn-download:active { transform: scale(0.98); opacity: 0.9; }
    </style>
</head>
<body>
    <div id="games-container"></div>
    
    <script src="games.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        const container = document.getElementById('games-container');

        // Función segura para enviar
        window.enviar = function(cmd) {
            tg.sendData(cmd);
            tg.close();
        }

        function render() {
            if (typeof DATABASE_JUEGOS === 'undefined') {
                container.innerHTML = "<p style='text-align:center; color:red'>Error: No cargó games.js</p>";
                return;
            }

            DATABASE_JUEGOS.forEach(game => {
                // AQUÍ ESTÁ EL TRUCO DEL PROXY PARA QUE SE VEAN LAS FOTOS
                // Usamos 'images.weserv.nl' para cargar la foto aunque la web original no quiera
                let imgUrl = game.imagen;
                if (imgUrl.startsWith('http')) {
                    imgUrl = `https://images.weserv.nl/?url=${encodeURIComponent(imgUrl)}&w=150&h=200&fit=cover&output=jpg`;
                } else {
                    imgUrl = 'https://via.placeholder.com/150?text=TITOMX';
                }

                const div = document.createElement('div');
                div.className = 'game-card';
                div.innerHTML = `
                    <img class="game-img" src="${imgUrl}" onerror="this.src='https://via.placeholder.com/150?text=Error'">
                    <div class="game-info">
                        <div>
                            <h3>${game.titulo}</h3>
                            <div class="meta">${game.info}</div>
                            <div class="desc">${game.desc}</div>
                        </div>
                        <button class="btn-download" onclick="enviar('${game.comando}')">
                            DESCARGAR AHORA
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        render();
    </script>
</body>
</html>
