<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TITOMX ARCADE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #00ff88; --bg: #0f0f0f; --card: #1a1a1a; --text: #fff; --gray: #888; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0 0 70px 0; -webkit-tap-highlight-color: transparent; }
        
        /* HEADER FIJO */
        .header { position: sticky; top: 0; background: rgba(15,15,15,0.95); z-index: 100; padding: 15px; backdrop-filter: blur(10px); border-bottom: 1px solid #333; }
        .search-bar { width: 100%; background: #222; border: none; padding: 12px 15px; border-radius: 12px; color: white; font-size: 16px; outline: none; box-sizing: border-box; transition: 0.3s; }
        .search-bar:focus { background: #333; box-shadow: 0 0 0 2px var(--primary); }

        /* CATEGORIAS (SCROLL HORIZONTAL) */
        .categories { display: flex; overflow-x: auto; padding: 10px 15px; gap: 10px; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        .cat-pill { background: #333; padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .cat-pill.active { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); }

        /* CONTENEDORES */
        .view-section { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* TARJETAS DE JUEGOS */
        .game-card { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; position: relative; border: 1px solid #333; }
        .game-img { width: 85px; height: 115px; object-fit: cover; border-radius: 8px; background: #222; }
        .game-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        h3 { margin: 0 0 5px 0; font-size: 15px; line-height: 1.2; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { color: var(--primary); font-size: 11px; font-weight: bold; margin-bottom: 5px; }
        .desc { font-size: 10px; color: var(--gray); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .actions { display: flex; gap: 10px; margin-top: 8px; }
        .btn-dl { flex: 1; background: linear-gradient(90deg, #0088cc, #005f8f); color: white; border: none; padding: 8px; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .btn-fav { width: 32px; background: #333; border: none; border-radius: 6px; color: #555; cursor: pointer; font-size: 14px; }
        .btn-fav.is-fav { color: #ff4757; }

        /* TUTORIALES */
        .tut-card { background: linear-gradient(45deg, #222, #333); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
        .tut-title { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .tut-desc { font-size: 11px; color: #aaa; }

        /* BARRA NAVEGACION INFERIOR */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #161616; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #333; z-index: 1000; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
        .nav-item { color: #666; text-align: center; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 18px; margin-bottom: 4px; display: block; }
        .nav-item.active { color: var(--primary); }

        /* ESTADO VACIO */
        .empty-state { text-align: center; color: #555; margin-top: 50px; }
        .empty-state i { font-size: 40px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="view-games" class="view-section active">
        <div class="header">
            <input type="text" id="searchInput" class="search-bar" placeholder="üîç Buscar juego (ej: Resident Evil)..." onkeyup="filtrarJuegos()">
        </div>
        
        <div class="categories" id="cat-container">
            <div class="cat-pill active" onclick="filtrarCategoria('Todo')">üî• Todo</div>
            <div class="cat-pill" onclick="filtrarCategoria('Accion')">‚öîÔ∏è Acci√≥n</div>
            <div class="cat-pill" onclick="filtrarCategoria('Aventura')">üó∫Ô∏è Aventura</div>
            <div class="cat-pill" onclick="filtrarCategoria('Deportes')">‚öΩ Deportes</div>
            <div class="cat-pill" onclick="filtrarCategoria('Estrategia')">üß† Estrategia</div>
            <div class="cat-pill" onclick="filtrarCategoria('Terror')">üëª Terror</div>
            <div class="cat-pill" onclick="filtrarCategoria('Carreras')">üèéÔ∏è Carreras</div>
            <div class="cat-pill" onclick="filtrarCategoria('Simulacion')">üèóÔ∏è Simulaci√≥n</div>
        </div>

        <div id="games-container" style="padding-top: 10px;"></div>
    </div>

    <div id="view-favs" class="view-section">
        <h2 style="margin: 20px 0 10px 0; padding-left: 10px;">‚ù§Ô∏è Mis Favoritos</h2>
        <div id="favs-container"></div>
    </div>

    <div id="view-tutos" class="view-section">
        <h2 style="margin: 20px 0 10px 0; padding-left: 10px;">üìö Academia TitoMX</h2>
        <div id="tutos-container">
            </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="cambiarTab('games', this)">
            <i class="fas fa-gamepad"></i> Juegos
        </div>
        <div class="nav-item" onclick="cambiarTab('favs', this)">
            <i class="fas fa-heart"></i> Favoritos
        </div>
        <div class="nav-item" onclick="cambiarTab('tutos', this)">
            <i class="fas fa-graduation-cap"></i> Tutoriales
        </div>
    </div>

    <script src="games.js"></script> 
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        // --- DATOS DE TUTORIALES (CONFIGURA AQU√ç) ---
        const DATABASE_TUTOS = [
            { titulo: "üì• C√≥mo descargar sin l√≠mites", desc: "Aprende a usar el bot para bajar juegos pesados.", link: "https://t.me/TitoYTVIP" },
            { titulo: "üéÆ Instalar juegos ISO", desc: "Gu√≠a para montar im√°genes ISO en Windows 10/11.", link: "https://t.me/TitoYTVIP" },
            { titulo: "üîß Soluci√≥n errores DLL", desc: "¬øTe falta un archivo dll? Mira esto.", link: "https://t.me/TitoYTVIP" }
        ];

        // --- SISTEMA INTELIGENTE DE CATEGOR√çAS ---
        // Palabras clave para detectar g√©nero autom√°ticamente
        const KEYWORDS = {
            'Accion': ['war', 'fight', 'duty', 'battle', 'combat', 'kill', 'dead', 'gun', 'sniper', 'evil', 'resident', 'devil', 'crysis', 'halo', 'doom'],
            'Aventura': ['tomb', 'raider', 'uncharted', 'assassin', 'creed', 'god', 'zelda', 'horizon', 'stray', 'lego', 'prince', 'journey'],
            'Deportes': ['fifa', 'pes', 'nba', 'soccer', 'football', 'wwe', 'ufc', 'tennis', 'golf', 'skate', 'f1', 'manager'],
            'Estrategia': ['age of', 'empire', 'civilization', 'warcraft', 'starcraft', 'total war', 'command', 'tycoon', 'city', 'anno'],
            'Terror': ['silent', 'hill', 'outlast', 'fnaf', 'freddy', 'dark', 'nightmare', 'fear', 'dead space', 'alien'],
            'Carreras': ['need for speed', 'forza', 'gran turismo', 'dirt', 'rally', 'moto', 'car', 'driver', 'burnout', 'asphalt'],
            'Simulacion': ['sims', 'simulator', 'truck', 'flight', 'farm', 'mechanic', 'train', 'bus']
        };

        let juegosMostrados = [];
        let favoritos = JSON.parse(localStorage.getItem('tito_favs')) || [];
        let categoriaActual = 'Todo';

        // --- INICIALIZACI√ìN ---
        function init() {
            if (typeof DATABASE_JUEGOS === 'undefined') {
                document.getElementById('games-container').innerHTML = "<p style='text-align:center; color:red'>‚ö†Ô∏è Error: Sube games.js</p>";
                return;
            }
            juegosMostrados = DATABASE_JUEGOS;
            renderJuegos(juegosMostrados, 'games-container');
            renderTutos();
        }

        // --- L√ìGICA DE RENDERIZADO ---
        function renderJuegos(lista, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            if (lista.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-ghost"></i><br>Nada por aqu√≠...</div>`;
                return;
            }

            // Usamos un fragmento para que sea ultra r√°pido
            const fragment = document.createDocumentFragment();

            lista.forEach(game => {
                const isFav = favoritos.includes(game.titulo);
                
                // Proxy de imagen para saltar protecci√≥n
                let imgUrl = game.imagen;
                if (imgUrl.startsWith('http')) {
                    imgUrl = `https://images.weserv.nl/?url=${encodeURIComponent(imgUrl)}&w=150&h=200&fit=cover&output=jpg`;
                } else {
                    imgUrl = 'https://via.placeholder.com/150?text=TITOMX';
                }

                const div = document.createElement('div');
                div.className = 'game-card';
                div.innerHTML = `
                    <img class="game-img" src="${imgUrl}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Error'">
                    <div class="game-info">
                        <div>
                            <h3>${game.titulo}</h3>
                            <div class="meta">${game.info}</div>
                            <div class="desc">${game.desc}</div>
                        </div>
                        <div class="actions">
                            <button class="btn-dl" onclick="descargar('${game.comando}')">
                                <i class="fas fa-download"></i> BAJAR
                            </button>
                            <button class="btn-fav ${isFav ? 'is-fav' : ''}" onclick="toggleFav('${game.titulo.replace(/'/g, "\\'")}')">
                                <i class="fas ${isFav ? 'fa-heart' : 'fa-heart'}"></i>
                            </button>
                        </div>
                    </div>
                `;
                fragment.appendChild(div);
            });
            container.appendChild(fragment);
        }

        function renderTutos() {
            const container = document.getElementById('tutos-container');
            DATABASE_TUTOS.forEach(tut => {
                const div = document.createElement('div');
                div.className = 'tut-card';
                div.innerHTML = `
                    <div class="tut-title">${tut.titulo}</div>
                    <div class="tut-desc">${tut.desc}</div>
                    <button class="btn-dl" style="margin-top:10px; width:auto; padding:5px 15px;" onclick="window.open('${tut.link}', '_blank')">Ver Tutorial</button>
                `;
                container.appendChild(div);
            });
        }

        // --- FILTROS INTELIGENTES ---
        function filtrarCategoria(cat) {
            categoriaActual = cat;
            
            // Actualizar estilo de botones
            document.querySelectorAll('.cat-pill').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');

            if (cat === 'Todo') {
                juegosMostrados = DATABASE_JUEGOS;
            } else {
                // AQU√ç EST√Å LA IA (B√öSQUEDA POR PALABRAS CLAVE)
                const palabras = KEYWORDS[cat];
                juegosMostrados = DATABASE_JUEGOS.filter(game => {
                    const txt = (game.titulo + " " + game.desc).toLowerCase();
                    return palabras.some(p => txt.includes(p));
                });
            }
            renderJuegos(juegosMostrados, 'games-container');
        }

        function filtrarJuegos() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const listaBase = categoriaActual === 'Todo' ? DATABASE_JUEGOS : juegosMostrados;
            
            const filtrados = listaBase.filter(game => 
                game.titulo.toLowerCase().includes(q)
            );
            renderJuegos(filtrados, 'games-container');
        }

        // --- FAVORITOS ---
        function toggleFav(titulo) {
            if (favoritos.includes(titulo)) {
                favoritos = favoritos.filter(t => t !== titulo);
            } else {
                favoritos.push(titulo);
            }
            localStorage.setItem('tito_favs', JSON.stringify(favoritos));
            
            // Re-renderizar la vista actual para actualizar el coraz√≥n
            if (document.getElementById('view-games').classList.contains('active')) {
                filtrarJuegos(); // Refresca la lista actual
            } else {
                cargarFavoritos(); // Refresca la vista de favoritos
            }
        }

        function cargarFavoritos() {
            const listaFavs = DATABASE_JUEGOS.filter(g => favoritos.includes(g.titulo));
            renderJuegos(listaFavs, 'favs-container');
        }

        // --- NAVEGACI√ìN ---
        function cambiarTab(tab, element) {
            // Ocultar todo
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // Mostrar selecci√≥n
            document.getElementById('view-' + tab).classList.add('active');
            element.classList.add('active');

            if (tab === 'favs') cargarFavoritos();
            
            // Scroll arriba suave
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // --- COMUNICACI√ìN CON BOT ---
        function descargar(cmd) {
            tg.sendData(cmd);
            tg.close();
        }

        // Arrancar
        init();

    </script>
</body>
</html>
