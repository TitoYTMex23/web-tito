<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TITOMX STORE ULTIMATE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root { --primary: #00e5ff; --bg: #0a0a0a; --card: #141414; --text: #fff; --gray: #aaa; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0 0 70px 0; -webkit-tap-highlight-color: transparent; }
        
        /* HEADER Y BUSCADOR */
        .header { position: sticky; top: 0; background: rgba(10,10,10,0.95); z-index: 100; padding: 15px; backdrop-filter: blur(10px); border-bottom: 1px solid #222; }
        .logo { text-align: center; font-weight: 900; font-size: 24px; letter-spacing: 2px; margin-bottom: 10px; }
        .logo span { color: var(--primary); }
        .search-bar { width: 100%; background: #222; border: 1px solid #333; padding: 12px 15px; border-radius: 30px; color: white; font-size: 14px; outline: none; transition: 0.3s; text-align: center; }
        .search-bar:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 229, 255, 0.3); }

        /* CARRUSEL DESTACADOS (Estilo Compu-PC) */
        .featured-container { padding: 15px; }
        .swiper { width: 100%; height: 220px; border-radius: 12px; overflow: hidden; }
        .swiper-slide { position: relative; background-size: cover; background-position: center; }
        .slide-content { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px 15px; box-sizing: border-box; }
        .slide-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .slide-badge { background: var(--primary); color: black; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; }

        /* CATEGORIAS */
        .categories { display: flex; overflow-x: auto; padding: 10px 15px; gap: 10px; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        .cat-pill { background: #222; padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; transition: 0.2s; border: 1px solid #333; }
        .cat-pill.active { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 229, 255, 0.4); }

        /* SECCIONES */
        .view-section { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .section-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        /* TARJETAS DE JUEGOS */
        .game-card { background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 15px; display: flex; gap: 15px; position: relative; border: 1px solid #222; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .game-img { width: 90px; height: 130px; object-fit: cover; border-radius: 8px; background: #222; }
        .game-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        h3 { margin: 0 0 5px 0; font-size: 16px; font-weight: bold; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { color: var(--primary); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .desc { font-size: 11px; color: var(--gray); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .actions { display: flex; gap: 8px; margin-top: 10px; }
        .btn-base { flex: 1; border: none; padding: 10px; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; }
        .btn-dl { background: linear-gradient(135deg, var(--primary), #0088cc); color: black; }
        .btn-video { background: #333; color: white; border: 1px solid #444; }
        .btn-fav { width: 36px; flex: none; background: #333; border: 1px solid #444; color: #666; font-size: 16px; }
        .btn-fav.is-fav { color: #ff4757; border-color: #ff4757; background: rgba(255, 71, 87, 0.1); }
        .btn-base:active { transform: scale(0.97); }

        /* MODAL DE VIDEO */
        #video-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; }
        .video-container { width: 90%; max-width: 600px; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; border: 2px solid var(--primary); }
        .close-video { margin-top: 20px; background: none; border: 2px solid white; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; }

        /* TIENDA */
        .store-grid { display: grid; grid-template-columns: repeat(2, 1.0fr); gap: 15px; }
        .store-item { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; }
        .store-img { width: 100%; height: 120px; object-fit: cover; }
        .store-info { padding: 10px; }
        .store-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .store-price { color: var(--primary); font-weight: bold; font-size: 16px; }
        .btn-buy { width: 100%; background: var(--primary); border: none; padding: 8px; border-radius: 6px; font-weight: bold; margin-top: 10px; cursor: pointer; color: black;}

        /* BARRA NAVEGACION INFERIOR */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(20,20,20,0.98); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #222; z-index: 1000; backdrop-filter: blur(10px); padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
        .nav-item { color: #666; text-align: center; font-size: 10px; cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
    </style>
</head>
<body>

    <div id="video-modal">
        <div class="video-container">
            <iframe id="video-frame" width="100%" height="100%" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
        <button class="close-video" onclick="cerrarVideo()"><i class="fas fa-times"></i> CERRAR TRAILER</button>
    </div>

    <div id="view-games" class="view-section active" style="padding: 0;">
        <div class="header">
            <div class="logo">TITO<span>MX</span> STORE</div>
            <input type="text" id="searchInput" class="search-bar" placeholder="üîç ¬øQu√© quieres jugar hoy?..." onkeyup="filtrarJuegos()">
        </div>
        
        <div class="featured-container">
            <div class="swiper">
                <div class="swiper-wrapper" id="featured-wrapper">
                    </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
        
        <div class="categories" id="cat-container">
            <div class="cat-pill active" onclick="filtrarCategoria('Todo')">üî• Todo</div>
            <div class="cat-pill" onclick="filtrarCategoria('Accion')">‚öîÔ∏è Acci√≥n</div>
            <div class="cat-pill" onclick="filtrarCategoria('Aventura')">üó∫Ô∏è Aventura</div>
            <div class="cat-pill" onclick="filtrarCategoria('Deportes')">‚öΩ Deportes</div>
            <div class="cat-pill" onclick="filtrarCategoria('Estrategia')">üß† Estrategia</div>
            <div class="cat-pill" onclick="filtrarCategoria('Carreras')">üèéÔ∏è Carreras</div>
            <div class="cat-pill" onclick="filtrarCategoria('Simulacion')">üèóÔ∏è Simulaci√≥n</div>
        </div>

        <div id="games-container" style="padding: 15px;"></div>
    </div>

    <div id="view-store" class="view-section">
        <div class="section-title"><i class="fas fa-shopping-cart" style="color: var(--primary);"></i> Tienda Oficial</div>
        <p style="color: #888; font-size: 12px; margin-bottom: 20px;">Art√≠culos exclusivos de TitoMX. Pagos v√≠a Transferm√≥vil/Enzona.</p>
        
        <div class="store-grid" id="store-container">
            <div class="store-item">
                <img src="https://via.placeholder.com/300x200?text=Membresia+VIP" class="store-img">
                <div class="store-info">
                    <div class="store-title">Membres√≠a VIP (30 D√≠as)</div>
                    <div class="store-price">$1000 CUP</div>
                    <button class="btn-buy" onclick="comprar('VIP 30 Dias')">COMPRAR AHORA</button>
                </div>
            </div>
             <div class="store-item">
                <img src="https://via.placeholder.com/300x200?text=Disco+Duro" class="store-img">
                <div class="store-info">
                    <div class="store-title">Disco Lleno (1TB)</div>
                    <div class="store-price">$5000 CUP</div>
                    <button class="btn-buy" onclick="comprar('Disco 1TB')">COMPRAR AHORA</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-favs" class="view-section">
        <div class="section-title"><i class="fas fa-heart" style="color: var(--primary);"></i> Mis Favoritos</div>
        <div id="favs-container"></div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="cambiarTab('games', this)">
            <i class="fas fa-gamepad"></i> Juegos
        </div>
         <div class="nav-item" onclick="cambiarTab('store', this)">
            <i class="fas fa-store"></i> Tienda
        </div>
        <div class="nav-item" onclick="cambiarTab('favs', this)">
            <i class="fas fa-heart"></i> Favoritos
        </div>
    </div>

    <script src="games.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        // PALABRAS CLAVE PARA INTELIGENCIA ARTIFICIAL
        const KEYWORDS = {
            'Accion': ['war', 'fight', 'duty', 'battle', 'combat', 'kill', 'dead', 'gun', 'sniper', 'evil', 'resident', 'devil', 'crysis', 'halo', 'doom', 'shooter'],
            'Aventura': ['tomb', 'raider', 'uncharted', 'assassin', 'creed', 'god', 'zelda', 'horizon', 'stray', 'lego', 'prince', 'journey', 'hogwarts'],
            'Deportes': ['fifa', 'pes', 'nba', 'soccer', 'football', 'wwe', 'ufc', 'tennis', 'golf', 'skate', 'f1', 'manager', 'fc 24'],
            'Estrategia': ['age of', 'empire', 'civilization', 'warcraft', 'starcraft', 'total war', 'command', 'tycoon', 'city', 'anno', 'crusader'],
            'Carreras': ['need for speed', 'forza', 'gran turismo', 'dirt', 'rally', 'moto', 'car', 'driver', 'burnout', 'asphalt', 'hot wheels'],
            'Simulacion': ['sims', 'simulator', 'truck', 'flight', 'farm', 'mechanic', 'train', 'bus', 'house flipper']
        };

        let juegosMostrados = [];
        let favoritos = JSON.parse(localStorage.getItem('tito_favs_pro')) || [];
        let categoriaActual = 'Todo';
        let swiper;

        function init() {
            if (typeof DATABASE_JUEGOS === 'undefined') {
                document.getElementById('games-container').innerHTML = "<p style='text-align:center; color:red'>‚ö†Ô∏è Error: Sube games.js</p>";
                return;
            }
            juegosMostrados = DATABASE_JUEGOS;
            renderDestacados(); // Cargar el carrusel
            renderJuegos(juegosMostrados, 'games-container');
        }

        // --- RENDERIZAR CARRUSEL SUPERIOR ---
        function renderDestacados() {
            const wrapper = document.getElementById('featured-wrapper');
            // Filtramos los juegos que marcaste con "destacado: true" en games.js
            const destacados = DATABASE_JUEGOS.filter(g => g.destacado === true).slice(0, 5); // M√°ximo 5
            
            if (destacados.length === 0) {
                document.querySelector('.featured-container').style.display = 'none';
                return;
            }

            destacados.forEach(game => {
                let imgUrl = getProxyImg(game.imagen);
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.style.backgroundImage = `url('${imgUrl}')`;
                slide.innerHTML = `
                    <div class="slide-content">
                        <span class="slide-badge">DESTACADO</span>
                        <div class="slide-title">${game.titulo}</div>
                        <button class="btn-base btn-dl" style="width: auto; padding: 8px 20px;" onclick="descargar('${game.comando}')">
                            <i class="fas fa-rocket"></i> DESCARGAR AHORA
                        </button>
                    </div>
                `;
                wrapper.appendChild(slide);
            });

            // Iniciar SwiperJS
            swiper = new Swiper('.swiper', {
                slidesPerView: 1,
                spaceBetween: 10,
                loop: true,
                autoplay: { delay: 3000, disableOnInteraction: false },
                pagination: { el: '.swiper-pagination', clickable: true },
            });
        }

        // --- RENDERIZADO PRINCIPAL DE JUEGOS ---
        function renderJuegos(lista, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            const fragment = document.createDocumentFragment();

            lista.forEach(game => {
                const isFav = favoritos.includes(game.titulo);
                let imgUrl = getProxyImg(game.imagen);

                const div = document.createElement('div');
                div.className = 'game-card';
                
                // L√≥gica de Botones: Si tiene video, muestra el bot√≥n de video
                let videoBtn = '';
                if (game.video) {
                    videoBtn = `
                        <button class="btn-base btn-video" onclick="verVideo('${game.video}')">
                            <i class="fas fa-play-circle"></i> TRAILER
                        </button>
                    `;
                }

                div.innerHTML = `
                    <img class="game-img" src="${imgUrl}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Error'">
                    <div class="game-info">
                        <div>
                            <h3>${game.titulo}</h3>
                            <div class="meta">${game.info}</div>
                            <div class="desc">${game.desc}</div>
                        </div>
                        <div class="actions">
                            <button class="btn-base btn-dl" onclick="descargar('${game.comando}')">
                                <i class="fas fa-download"></i> BAJAR
                            </button>
                            ${videoBtn}
                            <button class="btn-base btn-fav ${isFav ? 'is-fav' : ''}" onclick="toggleFav('${game.titulo.replace(/'/g, "\\'")}')">
                                <i class="fas ${isFav ? 'fa-heart' : 'fa-heart'}"></i>
                            </button>
                        </div>
                    </div>
                `;
                fragment.appendChild(div);
            });
            container.appendChild(fragment);
        }

        // --- FUNCIONES DE VIDEO ---
        function verVideo(url) {
            document.getElementById('video-frame').src = url;
            document.getElementById('video-modal').style.display = 'flex';
        }
        function cerrarVideo() {
            document.getElementById('video-frame').src = "";
            document.getElementById('video-modal').style.display = 'none';
        }

        // --- FILTROS E INTELIGENCIA ---
        function filtrarCategoria(cat) {
            categoriaActual = cat;
            document.querySelectorAll('.cat-pill').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            if (cat === 'Todo') {
                juegosMostrados = DATABASE_JUEGOS;
            } else {
                const palabras = KEYWORDS[cat];
                juegosMostrados = DATABASE_JUEGOS.filter(game => {
                    const txt = (game.titulo + " " + game.desc).toLowerCase();
                    return palabras.some(p => txt.includes(p));
                });
            }
            renderJuegos(juegosMostrados, 'games-container');
        }

        function filtrarJuegos() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const listaBase = categoriaActual === 'Todo' ? DATABASE_JUEGOS : juegosMostrados;
            const filtrados = listaBase.filter(game => game.titulo.toLowerCase().includes(q));
            renderJuegos(filtrados, 'games-container');
        }

        // --- UTILIDADES ---
        function getProxyImg(url) {
            if (url.startsWith('http') && !url.includes('placeholder')) {
                return `https://images.weserv.nl/?url=${encodeURIComponent(url)}&w=200&h=300&fit=cover&output=jpg`;
            }
            return url;
        }

        function toggleFav(titulo) {
            if (favoritos.includes(titulo)) favoritos = favoritos.filter(t => t !== titulo);
            else favoritos.push(titulo);
            localStorage.setItem('tito_favs_pro', JSON.stringify(favoritos));
            if (document.getElementById('view-games').classList.contains('active')) filtrarJuegos();
            else cargarFavoritos();
        }

        function cargarFavoritos() {
            const listaFavs = DATABASE_JUEGOS.filter(g => favoritos.includes(g.titulo));
            renderJuegos(listaFavs, 'favs-container');
        }

        // --- NAVEGACI√ìN Y ACCIONES ---
        function cambiarTab(tab, element) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + tab).classList.add('active');
            element.classList.add('active');
            if (tab === 'favs') cargarFavoritos();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function descargar(cmd) {
            tg.sendData(cmd);
            tg.close();
        }
        
        function comprar(item) {
            // Aqu√≠ luego conectaremos con el bot para pagar
            tg.sendData(`/comprar ${item}`);
            tg.close();
        }

        init();
    </script>
</body>
</html>
